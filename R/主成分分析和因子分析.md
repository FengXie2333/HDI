# 主成分与因子分析

##  常用步骤

1. 数据预处理   输入可以是原始矩阵或者相关系数矩阵  原始矩阵要确保没有缺失值
2. 选择因子模型  判断是使用PCA（数据降维）还是EFA（发现潜在结构）
3. 判断选择的主成分或因子的数目
4. 选择主成分或因子
5. 旋转
6. 解释结果
7. 计算主成分或因子得分

&nbsp;

## 主成分分析

PCA的目标是用一组较少的不相关变量代替大量相关变量，同时尽可能保留初始变量的信
息，这些推导所得的变量称为主成分，它们是观测变量的线性组合。如第一主成分为：

![](https://i.loli.net/2018/09/17/5b9f57b8b86be.jpg)

它是k个观测变量的加权组合，对初始变量集的方差解释性最大。第二主成分也是初始变量
的线性组合，对方差的解释性排第二，同时与第一主成分正交（不相关）。后面每一个主成分都
最大化它对方差的解释程度，同时与之前所有的主成分都正交 。

&nbsp;

### 判断主成分的个数

利用`fa.parallel() `同时对三种特征值判别准则进行评价 

~~~R
fa.parallel(USJudgeRatings[, -1], fa="pc", n.iter=100,
             show.legend=FALSE, main="Scree plot with parallel analysis")
~~~

![](https://i.loli.net/2018/09/17/5b9f59c0e6b81.jpg)

三个准则：

1. 特征值大于1
2. 大于随机数据矩阵推导出的特征值平均值（虚线）
3. Cattle碎石检验，图形变化最大处以上均可保留

&nbsp;

###  提取主成分

~~~R
library(psych)
pc <- principal(r, nfactors=, rotate=, scores=)
## r:相关系数矩阵或者原始矩阵
## nfactors：设定主成分数
## rotate：是否旋转
## scores：主成分得分
~~~

![](https://i.loli.net/2018/09/17/5b9f75ad0810e.jpg)

&nbsp;

PC1栏包含了成分载荷，指观测变量与主成分的相关系数 。成分载荷（ component loadings）可用来解释主成分的含义 。第一主成分（ PC1）与每个变量都高度相关，也就是说，它是一个可用来进行一般性评价的维度。 

&nbsp;

h2栏指成分公因子方差——主成分对每个变量的方差解释度 

u2栏指成分唯一性——方差无法被主成分解释的比例（ 1-h2） 

&nbsp;

###  主成分旋转

旋转方法有两种：使选择的成分保持不相关（ 正交旋转），和让它们变得相关（ 斜交旋转）。 最流行的正交旋转是方差极大旋转 

&nbsp;

方差极大旋转：它试图对载荷阵的列进行去噪，使得每个成分只是由一组有限的变量来解释（即载荷阵每列只有少数几个很大的载荷，其他都是很小的载荷） 

&nbsp;

### 获取主成分得分

设置`score`等于TRUE

当主成分分析基于相关系数矩阵时，原始数据便不可用了，也不可能获取每个观测的主成分得分，但是可以得到用来计算主成分得分的系数 

&nbsp;

##  探索性因子得分

协方差矩阵 需要用`cov2cor() `将其转化为相关系数矩阵 

&nbsp;

###  判断公共因子数

类似主成分判断

使用`fa.parallel`

&nbsp;

###  提取公共因子

~~~R
fa(r, nfactors, n.obs=, rotate=, scores=, fm=)  ### 使用相关性矩阵时，要设置n.obs
### fm:设定因子化方法（默认极小残差法） 
~~~

&nbsp;

统计学家青睐使用最大似然法，因为它有良好的统计性质。不过有时候最大似然法不会收敛，此时使用主轴迭代法效果会很好 .

最大似然法（ ml）

主轴迭代法（ pa）

加权最小二乘法（ wls）

广义加权最小二乘法（ gls）

最小残差法（ minres） 



###  因子旋转

正交旋转和斜交旋转

正交

~~~R
fa.varimax <- fa(correlations, nfactors=2, rotate="varimax", fm="pa")
~~~

使用正交旋转将人为地强制两个因子不相关。

斜交：

`fa.promax <- fa(correlations, nfactors=2, rotate="promax", fm="pa")` 

&nbsp;

对于正交旋转，因子分析的重点在于因子结构矩阵（变量与因子的相关系数），而对于斜交旋转，因子分析会考虑三个矩阵：因子结构矩阵、因子模式矩阵和因子关联矩阵。
因子模式矩阵即标准化的回归系数矩阵。它列出了因子预测变量的权重。 因子关联矩阵即因子相关系数矩阵。

&nbsp;

与正交旋转所得因子载荷阵相比，斜交的载荷阵列（因子结构矩阵）的噪音比较大，这是因为之前你允许潜在因子相关。虽然斜交方法更为复杂，但模型将更符合真实数据。 

&nbsp;

使用`factor.plot()`或`fa.diagram()`函数，可以绘制正交或者斜交结果的图形 

~~~R
factor.plot(fa.promax, labels=rownames(fa.promax$loadings))
~~~

 &nbsp;

![](https://i.loli.net/2018/09/17/5b9f730cddd73.jpg)

&nbsp;

~~~R
fa.diagram(fa.promax, simple=FALSE)
~~~

若使simple = TRUE，那么将仅显示每个因子下最大的载荷，以及因子间的相关系数 

&nbsp;

![](https://i.loli.net/2018/09/17/5b9f739014f81.jpg)

&nbsp;

##  步骤图

![](https://i.loli.net/2018/09/17/5b9f74abcc36c.jpg)